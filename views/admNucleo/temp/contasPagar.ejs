<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://ibadejuf.com.br/assets/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://ibadejuf.com.br/assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://ibadejuf.com.br/assets/vendors/themify-icons/css/themify-icons.css" rel="stylesheet" />
    <!--<link href="https://ibadejuf.com.br/assets/vendors/jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet" />-->
    <link href="https://ibadejuf.com.br/assets/css/main.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://paulkr.github.io/overhang.js/dist/overhang.min.css" />
	
    <style>
		form.form label.error, label.error {
		  color: red;
		  font-style: italic;
		}
        .content-wrapper {
            position: relative;
            background-color: #f7f7f7;
            background-color: #f2f2f2;
            background-color: #f1f1f1;
            margin-left: 200px;
            padding: 0 15px 60px 15px;
            padding-top: 0px;
            -webkit-transition: margin .2s ease-in-out;
            -o-transition: margin .2s ease-in-out;
            transition: margin .2s ease-in-out;
            min-height: 1000px;
        }

        .page-footer {
            position: absolute;
            left: 10px;
            bottom: 0;
            width: 100%;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 10px 15px;
            background-color: #fff;
        }
		
		@media (min-width: 768px) {
  .modal-xl {
    width: 90%;
   max-width:1200px;
  }
}

	.h4, h4 {
    font-size: 14px;
}
    </style>
</head>

<body class="fixed-navbar">
    <div class="page-wrapper">
        <!-- START HEADER-->
        <header class="header">
            <div class="page-brand">
                <%- include('./../partials/logo.ejs') %>
            </div>
            <div class="flexbox flex-1">
                <!-- START TOP-LEFT TOOLBAR-->
                <ul class="nav navbar-toolbar">
                    <li>
                        <a class="nav-link sidebar-toggler js-sidebar-toggler"><i class="ti-menu"></i></a>
                    </li>
                    <li>

                    </li>
                </ul>
                <!-- END TOP-LEFT TOOLBAR-->
                <!-- START TOP-RIGHT TOOLBAR-->
                <ul class="nav navbar-toolbar">

                </ul>
                <!-- END TOP-RIGHT TOOLBAR-->
            </div>
        </header>
        <!-- END HEADER-->
        <!-- START SIDEBAR-->
        <nav class="page-sidebar" id="sidebar">
            <div id="sidebar-collapse">
                <div class="admin-block d-flex">
                    <div>
                        <img src="https://ibadejuf.com.br/assets/img/admin-avatar.png" width="45px" />
                    </div>
                    <div class="admin-info">
                        <div class="font-strong"><%= user %></div><small>Administrator</small>
                    </div>
                </div>
                <%- include('./../partials/sidebar.ejs') %>
            </div>
        </nav>
        <!-- END SIDEBAR-->
        <div class="content-wrapper">
            <!-- START PAGE CONTENT-->
            <div class="page-content fade-in-up">
				<div class="col-lg-12">
					<div class="row">
						<div class="col-lg-6 col-md-6">
							<div class="ibox bg-success color-white widget-stat">
								<div class="ibox-body">
									<h2 class="m-b-5 font-strong"><%= vlr_contas_pagas %></h2>
									<div class="m-b-5">CONTAS PAGAS</div><i class="ti-bar-chart widget-stat-icon"></i>
									<!--<div><i class="fa fa-level-up m-r-5"></i><small>25% higher</small></div>-->
								</div>
							</div>
						</div>
						
						<div class="col-lg-6 col-md-6">
							<div class="ibox bg-danger color-white widget-stat">
								<div class="ibox-body">
									<h2 class="m-b-5 font-strong"><%= vlr_contas_a_pagar %></h2>
									<div class="m-b-5">CONTAS A PAGAR</div><i class="ti-bar-chart widget-stat-icon"></i>
									<!--<div><i class="fa fa-level-up m-r-5"></i><small>22% higher</small></div>-->
								</div>
							</div>
						</div>
						
					</div> 
				</div>
               
			
			
                <div class="col-lg-12">
					
                    <div class="ibox">
                        <div class="ibox-head">
                            <div class="ibox-title">Contas a Pagar 
								<button class="btn btn-primary" type="submit" data-toggle="modal" data-target="#modalExemplo" style="margin-left:15px;">+ Adicionar </button>
								<button class="btn btn-primary" type="submit" data-toggle="modal" data-target="#modalFornecedor" style="margin-left:15px;">+ Cadastrar Fornecedor </button>
								<button class="btn btn-primary" type="submit" data-toggle="modal" data-target="#modalContas" style="margin-left:15px;">+ Cadastrar Contas </button>
							</div>
							<!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                            Cadastrar Contas a Pagar
                          </button>-->
                        </div>
                        <div class="ibox-body">
							<table class="table datatable" id="datatable">
                            <thead>
                              <tr>
                                <th>Descrição</th>
								<th>Documento</th>
								<th>Vencimento</th>
								<th>Pagamento</th>
								<th>Valor</th>
								<th>Conta</th>
								<th>Fornecedor</th>
								<th>Status</th>
                              </tr>
                            </thead>
                            <tbody>
                                <% contas_a_pagar.forEach(dados=>{ %>
                              <tr>
                                <td><%= dados.descricao %></td>
								<td><%= dados.documento %></td>
								<td><%= dados.vencimento %></td>
								<td><%= dados.data_pagamento %></td>
								<td><%= dados.valor %></td>
								<td><%= dados.contas %></td>
								<td><%= dados.fornecedor %></td>
								<% if(dados.status=="Pago"){  %>
									<td><span class="badge badge-success m-r-5 m-b-5">PAGO</span></td>
								<% }else{  %>
									<td></td>
								<% } %>
                              </tr>
                              <% }) %>
                            </tbody>
                          </table>


                        </div>
                    </div>

                </div>

            </div>
            <!-- END PAGE CONTENT-->
            <%- include('./../partials/footer.ejs') %>
        </div>
    </div>

	<div class="modal fade" id="modalExemplo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Adicionar Contas a Pagar</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="formulario" action="javascript:func()" method="post">
					<input type="hidden" id="uid_usuario" value="<%= uid_usuario %>"/>
				
					<div class="row">
						<div class="col-sm-4" style="display:none">
							<h4 class="card-inside-title">Data </h2>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control date" id="data_atual" disabled />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12" style="margin-bottom: 15px;">
							<div class="check-list">
								<label class="ui-checkbox ui-checkbox-success">
									<input type="checkbox" id="pago">
									<span class="input-span"></span>Pago</label>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<h4 class="card-inside-title ">Descricao</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control" placeholder="Descrição" id="descricao" required />
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-sm-4">
							<h4 class="card-inside-title ">Documento</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control" placeholder="Documento" id="documento" required />
								</div>
							</div>
						</div>

						<div class="col-sm-4">
							<h4 class="card-inside-title ">Vencimento</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control date" placeholder="" id="vencimento" />
								</div>
							</div>
						</div>
						<div class="col-sm-4">
							<h4 class="card-inside-title ">Pagamento</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control " placeholder="" id="data_pagto" />
								</div>
							</div>
						</div>
					</div>
					
					<div class="row">	
						<div class="col-sm-3">
							<h4 class="card-inside-title ">Valor</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control money" placeholder="0.00" id="valor" />
								</div>
							</div>
						</div>
						<div class="col-sm-3">
							<h4 class="card-inside-title ">Valor Multa</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control money" placeholder="0.00" id="valor_multa" />
								</div>
							</div>
						</div>
						<div class="col-sm-3">
							<h4 class="card-inside-title ">Valor Juros</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control money" placeholder="0.00" id="valor_juros"  />
								</div>
							</div>
						</div>
						<div class="col-sm-3">
							<h4 class="card-inside-title ">Valor Total</h4>
							<div class="form-group">
								<div class="form-line">
									<input type="text" class="form-control money" placeholder="0.00" id="valor_total"  />
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<h4 class="card-inside-title ">Contas</h4>
							<div class="form-group">
								<select class="form-control select2" style="width: 100%;"  id="id_contas">
									<option value="" selected> Selecione </option>
									<% contas.forEach(contas=>{ %>
										<option value="<%= contas.id_contas %>"> <%=contas.descricao %> </option>
									<% }) %>
								</select>
							</div>
						</div>

						<div class="col-md-6">
							<h4 class="card-inside-title ">Fornecedor</h4>
							<div class="form-group">
								<select class="form-control select2" style="width: 100%;" name="id_fornecedor" id="id_fornecedor">
									<option value="" selected> Selecione </option>
									<% fornecedor.forEach(fornecedor=>{ %>
										<option value="<%=fornecedor.id_fornecedor %>"> <%=fornecedor.nome %> </option>
									<% }) %>
								</select>
							</div>
						</div>
						<div class="col-md-12">
							<div class="form-group">
								<label>Observação</label>
								<textarea class="form-control" rows="3" id="observacao"></textarea>
							</div>
						</div>
					</div>

				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
				<button class="btn btn-primary" type="submit" id="salvarContasaPagar"><i class="fa fa-fw fa-lg fa-check-circle"></i>Cadastrar</button>&nbsp;&nbsp;&nbsp;
			</div>
			</div>
		</div>
	</div>




	<div class="modal fade" id="modalFornecedor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Cadastrar Fornecedor</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="formulario" action="javascript:func()" method="post">
					<input type="hidden" id="uid_usuario" value="<%= uid_usuario %>"/>
				
					<div class="col-sm-12">
						<h4 class="card-inside-title ">Fornecedor</h4>
						<div class="form-group">
							<div class="form-line">
								<input type="text" class="form-control money" placeholder="" id="fornecedor"  />
							</div>
						</div>
					</div>

				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
				<button class="btn btn-primary" type="submit" id="salvarFornecedor"><i class="fa fa-fw fa-lg fa-check-circle"></i>Cadastrar</button>&nbsp;&nbsp;&nbsp;
			</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalContas" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Cadastrar Contas</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="formulario" action="javascript:func()" method="post">
					<input type="hidden" id="uid_usuario" value="<%= uid_usuario %>"/>
				
					<div class="col-sm-12">
						<h4 class="card-inside-title ">Conta</h4>
						<div class="form-group">
							<div class="form-line">
								<input type="text" class="form-control money" placeholder="" id="conta"  />
							</div>
						</div>
					</div>

				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
				<button class="btn btn-primary" type="submit" id="salvarConta"><i class="fa fa-fw fa-lg fa-check-circle"></i>Cadastrar</button>&nbsp;&nbsp;&nbsp;
			</div>
			</div>
		</div>
	</div>

    <!-- BEGIN PAGA BACKDROPS-->
    <div class="sidenav-backdrop backdrop"></div>
    <div class="preloader-backdrop">
        <div class="page-preloader">Loading</div>
    </div>
    <!--<script src="https://ibadejuf.com.br/assets/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script>-->
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="https://ibadejuf.com.br/assets/vendors/popper.js/dist/umd/popper.min.js" type="text/javascript"></script>
    <script src="https://ibadejuf.com.br/assets/vendors/bootstrap/dist/js/bootstrap.min.js" type="text/javascript">
    </script>
    <script src="https://ibadejuf.com.br/assets/vendors/metisMenu/dist/metisMenu.min.js" type="text/javascript"></script>
    <script src="https://ibadejuf.com.br/assets/js/app.min.js" type="text/javascript"></script>    
	<!--<script src="https://jqueryvalidation.org/files/dist/jquery.validate.js"></script>-->
	
	<script type="text/javascript" src="https://paulkr.github.io/overhang.js/dist/overhang.min.js"></script>
	
		<script type="text/javascript" language="javascript">
			$(document).ready(function() {			
			
				$("#cpf").mask("000.000.000-00");
				$("#cep").mask("00000-000");
				$("#telefone").mask("(00)00000-0000");
				$("#data").mask("00/00/0000");
				$("#data_pagto").mask("00/00/0000");
				$("#vencimento").mask("00/00/0000");
				$('#valor').mask('000.000.000.000.000,00', {reverse: true});
				$('#valor_multa').mask('000.000.000.000.000,00', {reverse: true});
				$('#valor_juros').mask('000.000.000.000.000,00', {reverse: true});
				$('#valor_total').mask('000.000.000.000.000,00', {reverse: true});

				
				$("#salvarConta").click(function(){
					var uid_usuario = $("#uid_usuario").val();
					var conta = $("#conta").val();
					
					$.post('/adm/addConta', {
						uid_usuario: uid_usuario,
						conta: conta
					}, function(resposta) {
						console.log(resposta);
						$("body").overhang({
							type: "success",
							message: "Conta cadastrada com sucesso.",
							duration: 2
						});
						setTimeout(() => {
						  location.reload(); 
						}, "2000");
						
					});
					
				})
				
				$("#salvarFornecedor").click(function(){
					var uid_usuario = $("#uid_usuario").val();
					var fornecedor = $("#fornecedor").val();
					
					$.post('/adm/addFornecedor', {
						uid_usuario: uid_usuario,
						fornecedor: fornecedor
					}, function(resposta) {
						console.log(resposta);
						$("body").overhang({
							type: "success",
							message: "Fornecedor cadastrado com sucesso.",
							duration: 2
						});
						setTimeout(() => {
						  location.reload(); 
						}, "2000");
						
					});
					
				})
				
				
				$("#salvarContasaPagar").click(function(){
					
					
					const checkbox = document.getElementById("pago");
					const isChecked = checkbox.checked;
					let _status = "";
					if (isChecked) {
					  console.log("O checkbox está marcado");
					  _status="Pago";
					} else {
					  console.log("O checkbox não está marcado");
					}
					
					var uid = $("#uid_usuario").val();
					var data_emissao = $("#data_atual").val();
					var descricao = $("#descricao").val();				
					var documento = $("#documento").val();
					var data_vencimento = $("#vencimento").val();
					var data_pagamento = $("#data_pagto").val();
					var valor = $("#valor").val();					
					var valor_multa = $("#valor_multa").val();
					var valor_juros = $("#valor_juros").val();
					var valor_total = $("#valor_total").val();
					var id_contas = $("#id_contas").val();					
					var id_fornecedor = $("#id_fornecedor").val();
					var observacao = $("#observacao").val();

					
					
					
					
					if(_status=="Pago" && data_pagamento==""){
						$("body").overhang({
							type: "error",
							message: "Informe a Data de Pagamentoto",
							duration: 2
						});
						$("#data_pagto").focus();
						return;
					}
					
					if(valor==""){
						$("body").overhang({
							type: "error",
							message: "Informe o Valor.",
							duration: 2
						});
						$("#valor").focus();
						return;
					}

					if(valor_total==""){
						valor_total = valor;
					}
					
					$.post('/adm/ContasPagar', {
						uid_usuario: uid,
						lancamento: data_emissao,
						descricao: descricao,
						documento: documento,
						
						vencimento: data_vencimento,
						data_pagto: data_pagamento,
						
						valor: valor,
						valor_multa: valor_multa,
						valor_juros: valor_juros,
						valor_total: valor_total,
						
						id_contas: id_contas,
						id_fornecedor: id_fornecedor,
						observacao: observacao,
						status: _status

					}, function(resposta) {
						$("body").overhang({
							type: "success",
							message: "Contas a pagar cadastrado com sucesso.",
							duration: 2
						});
						setTimeout(() => {
						  location.reload(); 
						}, "2000");
						
					});

				})
				
		
				var getData = dataAtual();
			
				document.getElementById("data_atual").value = getData;
				//document.getElementById("vencimento").value = getData;
			

				$("#modal-default").modal("show");
				
				
				function getCookie(name) {
					let cookies = document.cookie.split("; ");
					for (let i = 0; i < cookies.length; i++) {
						let cookie = cookies[i];
						let [cookieName, cookieValue] = cookie.split("=");
						if (cookieName === name) {
							return cookieValue;
						}
					}
					return null;
				}
            	
				function dataAtual(){
					var data = new Date();
					var dia = String(data.getDate()).padStart(2, '0');
					var mes = String(data.getMonth() + 1).padStart(2, '0');
					var ano = data.getFullYear();
					dataAtual = dia + '/' + mes + '/' + ano;

				   
					return dataAtual;
				}
			})
    </script>
</body>

</html>